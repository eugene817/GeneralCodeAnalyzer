#!/bin/sh
set -e

# 1) запускаем Ollama сервер в фоне
ollama serve &
PID="$!"

# 2) ждём несколько секунд, пока сервер реально начнёт слушать 0.0.0.0:11434
sleep 10

# 3) скачиваем модель, теперь Ollama CLI сможет достучаться к локальному серверу
ollama pull codegemma:2b

# 4) убиваем фоновый сервер (его pid сохранили в $PID)
kill "$PID"

# 5) перезапускаем сервер в foreground, модель уже на месте
exec ollama serve

